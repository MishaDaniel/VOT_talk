---
title: "Daghestanian stops"
subtitle: "VOT, CD and other stories"
author: "M. Daniel, S. Grawunder, G. Moroz, V. Zhigulskaya"
date: "2017/10/03"
output:
  xaringan::moon_reader:
    css: ["default", "my_theme.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE,
                      message=FALSE,
                      warning= FALSE,
                      fig.width=10.4,
                      fig.height=7)
library(tidyverse)
library(lingtypology)
library(ggridges)

df <- read_tsv("speakers.csv")
df %>% 
  distinct(Language, Location, lon, lat, color) -> 
  df_u

results <- read_tsv("results.tsv")
correspondence <- read_tsv("correspondence.tsv")

results %>% 
  left_join(correspondence) %>% 
  left_join(df) %>% 
  mutate(repetition = ifelse(repetition == "--undefined--", "", repetition),
         folVowDur = as.double(ifelse(folVowDur == "--undefined--",NA, folVowDur)),
         geminate = ifelse(grepl("[ː:]", stop),"+g", "-g"),
         aff_type = ifelse(grepl("[sz]", stop),"dent", NA),
         aff_type = ifelse(grepl("[ʃʒšžǯ]", stop),"alv", aff_type),
         aff_type = ifelse(grepl("ɬ", stop),"lat", aff_type),
         aff_type = ifelse(grepl("χ", stop),"uv", aff_type),
         affric = ifelse(grepl("ɬ", stop),"affricate", affric),
         affric = ifelse(grepl("χ", stop),"affricate", affric),
         aff_type = ifelse(grepl("χ", stop),"uv", aff_type),
         aff_type = factor(aff_type, levels = c("dent", "alv", "lat", "uv")),
         voice = ifelse(voice == "voiced", "+v", "-v")) %>% 
  mutate(VOT = fric + postfric,
         cd_n = closdur/folVowDur,
         vot_n = VOT/folVowDur,
         utterance = paste0(context, "_", repetition),
         poa = factor(poa, levels = c("bilabial", "dental", "velar", "uvular")),
         c_type = ifelse(glott == "glottalic", "ej", voice),
         c_type = ifelse(geminate == "+g", paste0(c_type, ",", "+g"), c_type),
         c_type = factor(c_type, levels = c("+v", "-v", "ej", "-v,+g", "ej,+g"))) ->
  final_df
```

class: inverse, center, middle

# Motivation

---

# Introduction

![](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/f_examples.png)

.pull-left[
Zilo speaker: **sit'a** ‘straw’
<audio controls>
  <source src="https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/a_zilo_sit'a_soloma.WAV" type="audio/wav">
</audio>
]

.pull-right[
Rutul speaker: **sit'aʔ** ‘bind’ 
<audio controls>
  <source src="https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/a_kina_sit'a'_zavyazhi.WAV" type="audio/wav">
</audio>
]

---
## CD and VOT values for **sit'a** ‘straw’ and **sit'aʔ** ‘bind’

```{r}
final_df %>% 
  filter(grepl("sit'aʔ|sit'a", word), c_type == "ej") %>% 
  rename(CD = closdur) %>% 
  select(Language, CD, VOT, Gender) %>% 
  gather(cd_vot, value, c(CD, VOT)) %>% 
  ggplot(aes(Language, value))+
  geom_boxplot()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(y = "Time (s)", x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~cd_vot, margins = "Gender", scales = "free_x")
```

---


# Introducing VOT

In 1964, Lisker and Abramson "proposed, with acoustic data from 11 languages, that the timing of glottal pulsing relative to supraglottal articulation would account for the great majority of homorganic consonantal distinctions traditionally said to depend on voicing, aspiration, "tensity", and the like" (Abramson and Whalen 2017).

---

.pull-left[ ![](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/f_LiskerAbramson.png)
]

.pull-right[
![](https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Vot.svg/400px-Vot.svg.png)
.pull-left[Lisker and Abramson (1964)]
.pull-right[from Wikipedia]
]

---
# Introducing VOT

Abramson & Whalen (2017) argue that VOT is a cross-linguistically useful (and simple) measure, even if not a universal discriminator. Examples of distinctions that are not covered are:
- aspirated voiced in Hindi: pH, p, b and bH. 
-- both latter sound types show negative VOT, bH showing breathy voice filling before the onset of modal voice)

- pre-aspirated in Swedish, Icelandic, Scots Gaelic and Tarascan
-- period of aspiration preceding a silent CD

- Korean: unaspirated, slightly aspirated and strongly aspirated (degree of VOT)

- implosives: prevoiced and accompanied by breathy voice, not distinguished from voiced by VOT 

- ejectives: see next slide

---
# Introducing VOT

Considering a sample of languages, (Ladefoged & Cho 2001) show that VOT measurements do not directly depend on sound types and oppositions. Below is the sub-sample that has ejectives:

.pull-left[

- Apache k, kʰ, k’ 

- Hupa k, kʰ, k’ 

- Navajo k, kʰ, k’ 

- Tlingit k, kʰ, k’ 

- Montana Salish k, k’

- Yapese k, k’

]

.pull-right[
![](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/f_LadefogedCho.png)
]

In our talk (and study), we want to consider how East Caucasian languages perform in terms of VOT, comparing voiceless and ejective stops.

---
class: inverse, center, middle

# Data

---
# Villages

```{r}
map.feature(df_u$Language,
            features = df_u$Language,
            tile = "Stamen.TerrainBackground",
            label = df_u$Location,
            label.hide = FALSE,
            label.fsize = 19,
            longitude = df_u$lon,
            latitude = df_u$lat,
            minimap = TRUE,
            minimap.position = "topleft",
            color = df_u$color)
```
---
# Speakers by village
```{r}
df %>% 
  count(Location) %>% 
  full_join(df) %>% 
  mutate(`(all)` = n) %>% 
  count(Location, `(all)`, Gender) %>% 
  spread(Gender, nn) %>% 
  mutate(f = ifelse(is.na(f), 0, f)) %>% 
  gather(Gender, n, `(all)`:m) ->
  annotation

df %>% 
  count(Location, Gender) %>% 
  full_join(df) %>% 
  filter(!is.na(Age)) ->
  df_plot

df_plot[,-2] %>% 
  mutate(Gender = "(all)") ->
  df_plot2

df_plot %>% 
  ggplot(aes(x = Age, y = Location)) +
  geom_density_ridges(aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_density_ridges(data = df_plot2, aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_text(data = annotation, aes(label = n, x = 2030), size = 8)+
  theme_bw()+
  facet_grid(~Gender)+
  theme(text = element_text(size=20))+
  labs(y = "", x = "",
       title = "Year of birth")+
  scale_x_continuous(breaks = 1:4*30+1890)
```
---
# Speakers by language
```{r}
df %>% 
  count(Language) %>% 
  full_join(df) %>% 
  mutate(`(all)` = n) %>% 
  count(Language, `(all)`, Gender) %>% 
  spread(Gender, nn) %>% 
  mutate(f = ifelse(is.na(f), 0, f)) %>% 
  gather(Gender, n, `(all)`:m) ->
  annotation

df %>% 
  count(Language, Gender) %>% 
  full_join(df) %>% 
  filter(!is.na(Age)) ->
  df_plot

df_plot[,-2] %>% 
  mutate(Gender = "(all)") ->
  df_plot2

df_plot %>% 
  ggplot(aes(x = Age, y = Language)) +
  geom_density_ridges(aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_density_ridges(data = df_plot2, aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_text(data = annotation, aes(label = n, x = 2030), size = 8)+
  theme_bw()+
  facet_grid(~Gender)+
  theme(text = element_text(size=20))+
  labs(y = "", x = "",
       title = "Year of birth")+
  scale_x_continuous(breaks = 1:4*30+1890)
```

---
# Features of stops and affricates

- **POA**: labial; dentalv; lateral; velar; uvular


- **manner**: stops; affricates


- **phonation type**: voiced; voiceless; ejective


- **geminates**







ADDITIONALLY:

- **labialization**


- **pharyngealization**


---
# Measurements

- Closure Duration (CD)



- Voice Onset Time (VOT)

  - Fricative part (FP)
  
  - Post-fricative part (PF)
  
  
  
- Following vowel duration

  - Creaky voice part of the vowel (CV)
  
  - Modal Voice part (M)
  
  
  
- (Intensity contour)

---
# Measurements

The word **kʷatʃʼa** ‘paw’ by Zilo speaker m_11:

![](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/f_annotation_example.png)

---
# Lists of words

- only existing words (non-words were at first used in Mehweb and then discarded)

- three repetitions followed by a carrier phrase

- all places of articulation X phonation type -> sound type

- initial and medial position

- when possible, two or more lexical items recorded for each sound and in each position

- keep the wordlist manageable (several dozens up to 100 words, 20-40 minutes recording session)

- phonetic context preferences: aCa > VCa > VCi, VCe (but not in Andi)

- stress position not controlled 

- eliciting words by a Russian translation, sometimes the target word hinted in a half voice or, ideally, distorted

---
class: inverse, center, middle

# Results so far

---

# Analysis

- 8 Mehwebs, 10 Kinas (Rutul), 9 Zilos (Andi)


- Annotation in Praat by K. Filatov, V. Ivanova, A. Kopeckiy, G. Moroz, M. Sheyanova?, I. Sieber, A. Zakirova, V. Zhigulskaya


- Data extraction with [**Praat Script by S. Grawunder**](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/segment_durations_1f.praat)

- Data analysis and visulization [**with R**](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/index.Rmd)

---
class: inverse, center, middle

# Stops: exploratory visualisation

---

# Absolute values of CD (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "plain") %>% 
  ggplot(aes(c_type, closdur, fill = poa))+
  geom_boxplot()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(y = "CD", x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender", scales = "free_x")
```

---
# Absolute values of VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "plain") %>% 
  ggplot(aes(c_type, VOT, fill = poa))+
  geom_boxplot()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender", scales = "free_x")
```

---
# Absolute values of CD ~ VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "plain") %>% 
  ggplot(aes(closdur, VOT, color = c_type))+
  geom_point()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender")
```

---
# Bagplots of absolute CD ~ VOT (medial)
```{r}
# from https://www.snip2code.com/Snippet/1122790/Basic-bagplot-geom-and-stat-for-ggplot2
StatBag <- ggproto("Statbag", Stat,
                   compute_group = function(data, scales, prop = 0.5) {
                     
                     #################################
                     # originally from aplpack package, plotting functions removed
                     plothulls_ <- function(x, y, fraction, n.hull = 1,
                                            col.hull, lty.hull, lwd.hull, density=0, ...){
                       # function for data peeling:
                       # x,y : data
                       # fraction.in.inner.hull : max percentage of points within the hull to be drawn
                       # n.hull : number of hulls to be plotted (if there is no fractiion argument)
                       # col.hull, lty.hull, lwd.hull : style of hull line
                       # plotting bits have been removed, BM 160321
                       # pw 130524
                       if(ncol(x) == 2){ y <- x[,2]; x <- x[,1] }
                       n <- length(x)
                       if(!missing(fraction)) { # find special hull
                         n.hull <- 1
                         if(missing(col.hull)) col.hull <- 1
                         if(missing(lty.hull)) lty.hull <- 1
                         if(missing(lwd.hull)) lwd.hull <- 1
                         x.old <- x; y.old <- y
                         idx <- chull(x,y); x.hull <- x[idx]; y.hull <- y[idx]
                         for( i in 1:(length(x)/3)){
                           x <- x[-idx]; y <- y[-idx]
                           if( (length(x)/n) < fraction ){
                            return(cbind(x.hull,y.hull))
                           }
                           idx <- chull(x,y); x.hull <- x[idx]; y.hull <- y[idx];
                         }
                       }
                       if(missing(col.hull)) col.hull <- 1:n.hull
                       if(length(col.hull)) col.hull <- rep(col.hull,n.hull)
                       if(missing(lty.hull)) lty.hull <- 1:n.hull
                       if(length(lty.hull)) lty.hull <- rep(lty.hull,n.hull)
                       if(missing(lwd.hull)) lwd.hull <- 1
                       if(length(lwd.hull)) lwd.hull <- rep(lwd.hull,n.hull)
                       result <- NULL
                       for( i in 1:n.hull){
                         idx <- chull(x,y); x.hull <- x[idx]; y.hull <- y[idx]
                         result <- c(result, list( cbind(x.hull,y.hull) ))
                          x <- x[-idx]; y <- y[-idx]
                         if(0 == length(x)) return(result)
                       }
                       result
                     } # end of definition of plothulls
                     #################################
                     
                     # prepare data to go into function
                     the_matrix <- matrix(data = c(data$x, data$y), ncol = 2)
                     
                     # get data out of function as df with names
                     setNames(data.frame(plothulls_(the_matrix, fraction = prop)), nm = c("x", "y"))
                   },
                   
                   required_aes = c("x", "y")
)

#' @inheritParams ggplot2::stat_identity
#' @param prop Proportion of all the points to be included in the bag (default is 0.5)
stat_bag <- function(mapping = NULL, data = NULL, geom = "polygon",
                     position = "identity", na.rm = FALSE, show.legend = NA, 
                     inherit.aes = TRUE, prop = 0.5, alpha = 0.3, ...) {
  layer(
    stat = StatBag, data = data, mapping = mapping, geom = geom, 
    position = position, show.legend = show.legend, inherit.aes = inherit.aes,
    params = list(na.rm = na.rm, prop = prop, alpha = alpha, ...)
  )
}


GeomPolygonHollow <- ggproto("GeomPolygonHollow", GeomPolygon,
                             default_aes = aes(colour = "black", fill = NA, size = 0.5, linetype = 1,
                                               alpha = NA)
)
geom_bag <- function(mapping = NULL, data = NULL, 
                       position = "identity", na.rm = FALSE, show.legend = NA, 
                       inherit.aes = TRUE, prop = 0.5, alpha = 0.3, ...) {
  layer(
    stat = StatBag, geom = GeomPolygonHollow, data = data, mapping = mapping,
    position = position, show.legend = show.legend, inherit.aes = inherit.aes,
    params = list(na.rm = na.rm, prop = prop, alpha = alpha, ...)
  )
}

final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "plain") %>% 
  ggplot(aes(closdur, VOT, fill = c_type))+
  geom_bag(alpha = 0.2)+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender")
```

---
class: inverse, center, middle

# Affricates: exploratory visualisation

---

# Absolute values of CD (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "affricate") %>% 
  ggplot(aes(c_type, closdur, fill = aff_type))+
  geom_boxplot()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(y = "CD", x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender", scales = "free_x")
```

---
# Absolute values of VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "affricate") %>% 
  ggplot(aes(c_type, VOT, fill = aff_type))+
  geom_boxplot()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender", scales = "free_x")
```

---
# Absolute values of CD ~ VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "affricate") %>% 
  ggplot(aes(closdur, VOT, color = c_type))+
  geom_point()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender")
```

---
# Bagplots of absolute CD ~ VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, position == "medial", affric == "affricate") %>% 
  ggplot(aes(closdur, VOT, fill = c_type))+
  geom_bag(alpha = 0.2)+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender")
```

---
class: inverse, center, middle

# Affricates: what if we treat VOT as a duration of postfricative part?

---

# Absolute values of VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, postfric > 0, position == "medial", affric == "affricate") %>% 
  ggplot(aes(c_type, postfric, fill = aff_type))+
  geom_boxplot()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", y = "post-fricative part", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender", scales = "free_x")
```

---
# Absolute values of CD ~ VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, postfric > 0, position == "medial", affric == "affricate") %>% 
  ggplot(aes(closdur, postfric, color = c_type))+
  geom_point()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", y = "post-fricative part", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender")
```

---
# Bagplots of absolute CD ~ VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, closdur < 0.31, postfric > 0, position == "medial", affric == "affricate") %>% 
  ggplot(aes(closdur, postfric, fill = c_type))+
  geom_bag(alpha = 0.2)+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "",y = "post-fricative part", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = "Gender")
```



---
# Methodological issues

- reliability  and comparability  of annotations made by different annotators
  - we need selective re-annotation and to compare the annotations and calculate
  - agreement per each of the features that we annotated (e. g. **Cohen’s kappa**);
  - agreement for time segmentation that we annotated (e. g. **??**).
--
Eventually, gross mistakes in annotation are corrected by Garik, Vasilisa and Sven.

- coding inconsistency
--
: we code with **f** burst of the stops and fricative part of the affricates.
--
- phonological interpretations
--
: _q_ or _q͡χ_?
--

- different contexts
--
:  lists of words were compiled using different principles (no voiced in Mehweb, very few speakers in Archi, no control for the following vowel quality in Andi etc.).
--

- possibility of loan phonetics?
--

- speaker inconsistency: some speak casually and some dictate (normalization?)
--

- different sound recordings conditions
--
: headset microphone vs. pure recorder' microphones; different recorders;

---

class: center, middle

# Thanks!

M. Daniel (misha.daniel@gmail.com)

S. Grawunder (grawunder@eva.mpg.de )

G. Moroz (agricolamz@gmail.com)

V. Zhigulskaya (vasilek224@bk.ru)

Slides created with the following R packages:

[**ggjoy**](https://CRAN.R-project.org/package=ggjoy)

[**ggplot2**](http://ggplot2.org)

[**lingtypology**](https://ropensci.github.io/lingtypology/)

[**xaringan**](https://github.com/yihui/xaringan)
