---
title: "Daghestanian stops"
subtitle: "VOT, CD and other stories"
author: "M. Daniel, S. Grawunder, G. Moroz, V. Zhigulskaya"
date: "2017/10/03"
output:
  xaringan::moon_reader:
    css: ["default", "my_theme.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE,
                      message=FALSE,
                      warning= FALSE,
                      fig.width=10.4,
                      fig.height=7)
library(tidyverse)
library(lingtypology)
library(ggridges)
library(stringr)
```

class: inverse, center, middle

# Motivation

---

# Introduction
Mehweb speaker: **q'ap'a** ‘lid’ 
<audio controls>
  <source src="https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/a_mehweb_q'ap'a.WAV" type="audio/wav">
</audio>

Zilo speaker: **bot'i** ‘blind’ 
<audio controls>
  <source src="https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/a_zilo_bot'i.WAV" type="audio/wav">
</audio>

---
class: inverse, center, middle

# Data

---
# Villages

```{r}
df <- read_tsv("speakers.csv")
df %>% 
  distinct(Language, Location, lon, lat, color) -> 
  df_u
map.feature(df_u$Language,
            features = df_u$Language,
            tile = "Stamen.TerrainBackground",
            label = df_u$Location,
            label.hide = FALSE,
            label.fsize = 19,
            longitude = df_u$lon,
            latitude = df_u$lat,
            minimap = TRUE,
            minimap.position = "topleft",
            color = df_u$color)
```
---
# Speakers by village
```{r}
df %>% 
  count(Location) %>% 
  full_join(df) %>% 
  mutate(`(all)` = n) %>% 
  count(Location, `(all)`, Gender) %>% 
  spread(Gender, nn) %>% 
  mutate(f = ifelse(is.na(f), 0, f)) %>% 
  gather(Gender, n, `(all)`:m) ->
  annotation

df %>% 
  count(Location, Gender) %>% 
  full_join(df) %>% 
  filter(!is.na(Age)) ->
  df_plot

df_plot[,-2] %>% 
  mutate(Gender = "(all)") ->
  df_plot2

df_plot %>% 
  ggplot(aes(x = Age, y = Location)) +
  geom_density_ridges(aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_density_ridges(data = df_plot2, aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_text(data = annotation, aes(label = n, x = 2030), size = 8)+
  theme_bw()+
  facet_grid(~Gender)+
  theme(text = element_text(size=20))+
  labs(y = "", x = "",
       title = "Year of birth")+
  scale_x_continuous(breaks = 1:4*30+1890)
```
---
# Speakers by language
```{r}
df %>% 
  count(Language) %>% 
  full_join(df) %>% 
  mutate(`(all)` = n) %>% 
  count(Language, `(all)`, Gender) %>% 
  spread(Gender, nn) %>% 
  mutate(f = ifelse(is.na(f), 0, f)) %>% 
  gather(Gender, n, `(all)`:m) ->
  annotation

df %>% 
  count(Language, Gender) %>% 
  full_join(df) %>% 
  filter(!is.na(Age)) ->
  df_plot

df_plot[,-2] %>% 
  mutate(Gender = "(all)") ->
  df_plot2

df_plot %>% 
  ggplot(aes(x = Age, y = Language)) +
  geom_density_ridges(aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_density_ridges(data = df_plot2, aes(fill = Gender), alpha = 0.6, show.legend = FALSE) +
  geom_text(data = annotation, aes(label = n, x = 2030), size = 8)+
  theme_bw()+
  facet_grid(~Gender)+
  theme(text = element_text(size=20))+
  labs(y = "", x = "",
       title = "Year of birth")+
  scale_x_continuous(breaks = 1:4*30+1890)
```

---
# Features of stops and affricates

- **POA**: labial; dental; lateral; postalveolar; velar; uvular
- **manner**: stops; affricates
- **phonation type**: voiced; voiceless; ejective
- **gemination**
- **labialization**
- **pharyngealization**
- **phonological context**: initial; medial
- **type of utterance**: first; second; third; carrier phrases

---
# Measurements

- Closure Duration (CD)
- Voice Onset Time (VOT)
  - Fricative part (FP)
  - Post-fricative part (PF)
- Following vowel duration
  - Creaky voice part of the vowel (CV)
  - Modal Voice part (M)
- Intensity contour

---
# Measurements

The word **kʷatʃʼa** ‘paw’ by Zilo speaker m_11:

![](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/f_annotation_example.png)

---
# Lists of words

---
# Problems

- reliability of annotations made by different annotators
--
: we need whole (partial?) reannatation and then we need to compare the annotations to calculate
  - agreement per each of the features that we annotated (e. g. **Cohen’s kappa**);
  - agreement for time segmentation that we annotated (e. g. **??**).

--

But Vasilisa checks and corrects other annotators work…

--

- phonological disagreement
--
: _q_ or _q͡χ_? Do we  realyl have _voiced sounds_?

--

- different contexts
--
: lists of words are made using different principals.

--

- coding inconsistency
--
: we code with **f** label burst of the stops and fricative part of the affricats?

--

- different sound recordings conditions
--
: headset microphone vs. pure recorder' microphones; different recorders;

---
class: inverse, center, middle

# Results

---

# Analysis

- Annotation in Praat by K. Filatov, V. Ivanova, A. Kopeckiy, G. Moroz, M. Sheyanova?, I. Sieber, A. Zakirova, V. Zhigulskaya
- Validation of annotation with [**Praat Script by G. Moroz**](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/annotation_check_1.praat)
- Data extraction with [**Praat Script by S. Grawunder**](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/segment_durations_1f.praat)
- Data analysis and visulization [**with R**](https://raw.githubusercontent.com/agricolamz/VOT_talk/master/docs/index.Rmd)

---
# Absolute values of CD (medial)
```{r}
results <- read_tsv("results.tsv")
correspondence <- read_tsv("correspondence.tsv")

results %>% 
  left_join(correspondence) %>% 
  left_join(df) %>% 
  mutate(repetition = ifelse(repetition == "--undefined--", "", repetition),
         poa = ifelse(poa == "dentalv","dental", poa),
         folVowDur = as.double(ifelse(folVowDur == "--undefined--",NA, folVowDur)),
         geminate = ifelse(grepl("[ː:]", stop),"+g", "-g"),
         voice = ifelse(voice == "voiced", "+v", "-v")) %>% 
  mutate(VOT = fric + postfric,
         cd_n = closdur/folVowDur,
         vot_n = VOT/folVowDur,
         utterance = paste0(context, "_", repetition),
         poa = factor(poa, levels = c("bilabial", "dental",  "velar", "uvular")),
         c_type = ifelse(glott == "glottalic", "ej", voice),
         c_type = factor(c_type, levels = c("+v", "-v", "ej"))) ->
  final_df

final_df %>% 
  filter(closdur > 0, position == "medial") %>% 
  ggplot(aes(c_type, closdur, fill = Language))+
  geom_violin()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(y = "CD", x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~poa, margins = TRUE)
```

---
# Absolute values of VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, position == "medial") %>% 
  ggplot(aes(c_type, VOT, fill = Language))+
  geom_violin()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~poa, margins = TRUE)
```

---
# Relative values of CD (medial)

```{r}
final_df %>% 
  filter(closdur > 0, folVowDur> 0, position == "medial") %>% 
  ggplot(aes(c_type, cd_n, fill = Language))+
  geom_violin()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(y = "CD (normolised)", x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~poa, margins = TRUE)
```

---
# Relative values of VOT (medial)

```{r}
final_df %>%
  filter(VOT > 0, folVowDur > 0, position == "medial") %>%
  ggplot(aes(c_type, vot_n, fill = Language)) +
  geom_violin() +
  theme_bw() +
  theme(text = element_text(size = 20), legend.position = "bottom") +
  labs(
  x = "",
  y = "VOT (normolised)",
  caption = paste("Based on",
  length(unique(results$filename)),
  "speakers")
  ) +
  facet_grid(Gender ~ poa, margins = TRUE)
```

---
# Absolute values of CD ~ VOT (medial)
```{r}
final_df %>% 
  filter(closdur > 0, position == "medial") %>% 
  ggplot(aes(closdur, VOT, color = c_type))+
  geom_point()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = TRUE)
```

---
# Relative values of CD ~ VOT (medial) 

```{r}
final_df %>% 
  filter(closdur > 0, position == "medial") %>% 
  ggplot(aes(cd_n, vot_n, color = c_type))+
  geom_point()+
  theme_bw()+
  theme(text = element_text(size=20), legend.position="bottom")+
  labs(x = "", caption = paste("Based on",
                       length(unique(results$filename)),
                       "speakers"))+
  facet_grid(Gender~Language, margins = TRUE)
```


---

class: center, middle

# Thanks!

M. Daniel (misha.daniel@gmail.com)

S. Grawunder (grawunder@eva.mpg.de )

G. Moroz (agricolamz@gmail.com)

V. Zhigulskaya (vasilek224@bk.ru)

Slides created with the following R packages:

[**ggjoy**](https://CRAN.R-project.org/package=ggjoy)

[**ggplot2**](http://ggplot2.org)

[**lingtypology**](https://ropensci.github.io/lingtypology/)

[**xaringan**](https://github.com/yihui/xaringan)
